<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#0d0f14" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>MindAR 行動版範例（圖像追蹤 + 截圖）</title>

  <!-- 字體（可替換） -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <!-- A-Frame 與 MindAR（鎖定版本） -->
  <script defer src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

  <style>
    :root{
      --bg:#0b0e14;
      --panel:#111520cc;
      --panel-solid:#141a24;
      --text:#e8f0ff;
      --muted:#9fb0c7;
      --brand:#4ea1ff;
      --brand-2:#7c4dff;
      --ok:#35d07f;
      --warn:#ffb02e;
      --err:#ff5d5d;
      --radius:14px;
      --blur:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;background:var(--bg);color:var(--text);margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;-webkit-tap-highlight-color:transparent}
    .app{
      position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;
      background: radial-gradient(130% 90% at 20% 10%, #0b1530 0%, #0b0e14 40%, #0b0e14 100%);
      padding:clamp(12px,5vw,24px); padding-bottom: max(16px, env(safe-area-inset-bottom));
    }
    .card{
      width:min(680px,92vw);
      background:linear-gradient(180deg,#141a24 0%,#0e131b 100%);
      border:1px solid #1f2a3a; border-radius:var(--radius); padding:24px;
      box-shadow:0 10px 30px #0009;
    }
    h1{margin:0 0 10px;font-size:clamp(20px,4.7vw,28px);font-weight:600;letter-spacing:.2px}
    p{margin:0;color:var(--muted);line-height:1.6}
    .cta{
      display:flex;gap:12px;flex-wrap:wrap;margin-top:16px
    }
    .btn{
      -webkit-appearance:none;appearance:none;cursor:pointer;
      border:none;border-radius:12px;padding:14px 18px;font-weight:600;font-size:16px;
      color:#06101f;background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
      box-shadow:0 8px 24px #4ea1ff40, inset 0 1px 0 #ffffff50; transition:transform .08s ease, filter .15s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.sec{
      background:#1a2330;color:var(--text);box-shadow: inset 0 0 0 1px #2b3a4f;
    }
    .hint{display:flex;gap:10px;align-items:flex-start;margin-top:10px;color:var(--muted);font-size:14px}
    .badge{padding:4px 8px;border-radius:999px;background:#182232;border:1px solid #2b3a4f;color:#a9c4ff;font-size:12px}

    /* AR 容器與浮動工具列 */
    .stage{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;
      opacity:0;pointer-events:none;transition:opacity .25s ease;
    }
    .stage.active{opacity:1;pointer-events:auto}
    .toolbar{
      position:fixed;inset:0;pointer-events:none;
    }
    .bar{
      position:absolute;left:0;right:0;display:flex;justify-content:space-between;align-items:center;
      padding:10px 14px;gap:8px;pointer-events:auto;
    }
    .bar.top{top: env(safe-area-inset-top); padding-top: max(6px, env(safe-area-inset-top))}
    .bar.bottom{bottom: env(safe-area-inset-bottom); padding-bottom: max(8px, env(safe-area-inset-bottom))}
    .glass{
      background:var(--panel);backdrop-filter: blur(var(--blur));
      border:1px solid #1d2736; border-radius:16px; box-shadow:0 10px 30px #0006; padding:8px;
    }
    .grp{display:flex;gap:8px}
    .iconbtn{
      display:inline-flex;align-items:center;gap:8px;
      background:#121a26;border:1px solid #223047;color:#dfe9ff;
      border-radius:12px;padding:10px 12px;font-weight:600;font-size:14px;cursor:pointer;
      box-shadow: inset 0 0 0 1px #1f2a3a; transition: filter .15s ease, transform .08s ease;
    }
    .iconbtn.primary{background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); color:#06101f;border-color:transparent}
    .iconbtn.green{background: linear-gradient(135deg, #34d399 0%, #10b981 100%); color:#062b1c}
    .iconbtn.red{background: linear-gradient(135deg, #ff7676 0%, #ff5151 100%); color:#2b0505}
    .icon{width:18px;height:18px;display:inline-block}
    .small{font-size:12px;color:var(--muted);margin-left:8px}

    /* 降級相機模式 */
    .fallback{
      position:fixed;inset:0;background:#000;display:none;align-items:center;justify-content:center;
    }
    .fallback.active{display:flex}
    #fallbackVideo{width:100%;height:100%;object-fit:cover}

    /* 提示/吐司 */
    .toast{
      position:fixed;left:50%;bottom:calc(20px + env(safe-area-inset-bottom));transform:translateX(-50%);
      background:#0e141f;border:1px solid #223047;color:#dfe9ff;border-radius:12px;padding:10px 14px;
      opacity:0;pointer-events:none;transition:opacity .25s ease;
    }
    .toast.show{opacity:1}
    .status{font-size:13px;color:#a4b5cc}

    /* A-Frame 置頂 */
    a-scene{position:fixed !important;inset:0 !important}
  </style>
</head>
<body>
  <div class="app" id="home">
    <div class="card">
      <div class="badge">MindAR + A‑Frame（行動裝置）</div>
      <h1>影像追蹤 AR（後鏡頭、影片/圖片覆層、可截圖）</h1>
      <p>點擊下方按鈕進入 AR。我們會先請求必要權限（相機、動作感測、螢幕常亮）並使用後鏡頭。若裝置不支援，會自動降級到純相機模式，依然可以截圖。</p>
      <div class="hint">測試圖像（用另一台裝置開）：&nbsp;<a href="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/assets/card/card.png" target="_blank">card.png</a></div>
      <div class="cta">
        <button class="btn" id="enterBtn">進入 AR</button>
        <button class="btn sec" id="howBtn">如何部署</button>
      </div>
      <div class="hint">
        <span class="status">註：相機需 HTTPS 或 localhost（iOS/Android 安全限制）。</span>
      </div>
    </div>
  </div>

  <!-- AR 場景 -->
  <div class="stage" id="stage">
    <!-- 浮動工具列 -->
    <div class="toolbar">
      <div class="bar top">
        <div class="glass grp">
          <button class="iconbtn" id="helpBtn">
            <span class="icon">❓</span>說明
          </button>
          <div class="small" id="statusText">就緒</div>
        </div>
        <div class="grp">
          <button class="iconbtn red" id="exitBtn"><span class="icon">✖</span>離開</button>
        </div>
      </div>
      <div class="bar bottom">
        <div class="grp"></div>
        <div class="grp glass">
          <button class="iconbtn primary" id="saveBtn"><span class="icon">📸</span>儲存</button>
        </div>
      </div>
    </div>

    <!-- A-Frame + MindAR（預設透明背景，保留繪圖緩衝方便截圖） -->
    <a-scene
      id="arScene"
      embedded
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      renderer="colorManagement: true; physicallyCorrectLights: true; alpha: true; antialias: true; preserveDrawingBuffer: true"
      background="transparent: true"
      mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/assets/card/targets.mind; filterMinCF: 0.0001; filterBeta: 0.01;"
      color-space="sRGB">
      <a-assets timeout="120000">
        <!-- 覆層圖片（可換你的圖） -->
        <img id="overlayImage" crossorigin="anonymous"
             src="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200&q=80&auto=format&fit=crop" />
        <!-- 覆層影片（可換你的影片；為了行動自動播放，需 muted + playsinline） -->
        <video id="overlayVideo" crossorigin="anonymous" muted playsinline loop preload="auto"
               src="https://cdn.coverr.co/videos/coverr-colourful-ink-1036/1080p.mp4"></video>
        <!-- 預留 3D 模型（需要時把 visible 設為 true 並指定你的 .glb/.gltf） -->
        <!-- <a-asset-item id="modelAsset" src="your-model.glb"></a-asset-item> -->
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- 目標 0：當偵測到指定圖片時顯示覆層 -->
      <a-entity mindar-image-target="targetIndex: 0">
        <!-- 覆層圖片平面 -->
        <a-plane src="#overlayImage"
                 position="0 0 0"
                 rotation="0 0 0"
                 width="1"
                 height="0.62"
                 material="shader: flat; opacity: 0.98;">
        </a-plane>

        <!-- 覆層影片平面（稍微浮在上層 0.01） -->
        <a-video src="#overlayVideo"
                 position="0 -0.05 0.01"
                 rotation="0 0 0"
                 width="1"
                 height="0.56"
                 material="shader: flat;">
        </a-video>

        <!-- 預留 3D 模型插槽（預設關閉） -->
        <a-entity id="modelSlot" visible="false"
                  position="0 0 0.08" rotation="0 0 0"
                  scale="0.3 0.3 0.3">
          <!-- 啟用時加上 gltf-model="#modelAsset" -->
        </a-entity>
      </a-entity>
    </a-scene>
  </div>

  <!-- 降級：純相機模式（AR 失敗或不支援時） -->
  <div class="fallback" id="fallback">
    <video id="fallbackVideo" autoplay playsinline muted></video>
    <div class="toolbar">
      <div class="bar top">
        <div class="glass grp">
          <div class="small">降級相機模式（仍可截圖）</div>
        </div>
        <div class="grp">
          <button class="iconbtn red" id="exitBtn2"><span class="icon">✖</span>離開</button>
        </div>
      </div>
      <div class="bar bottom">
        <div class="grp"></div>
        <div class="grp glass">
          <button class="iconbtn green" id="saveBtn2"><span class="icon">📸</span>儲存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 小吐司 -->
  <div class="toast" id="toast">已儲存到相簿（若未自動下載，將在新分頁開啟圖片，可長按儲存）</div>

  <script>
    // =========== 可調整設定（集中管理） ===========
    const CONFIG = {
      // MindAR 標靶（示範用）與測試圖 URL（用另一台裝置開）
      targetMind: 'https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/assets/card/targets.mind',
      targetImageForUser: 'https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.2/examples/assets/card/card.png',
      // 螢幕截圖檔名
      screenshotName: 'ar-capture.png',
      // 影片自動播放策略（建議 true；若你要聲音，請在互動後手動播放並移除 muted）
      autoplayOverlayVideo: true,
    };

    // =========== 全域狀態 ===========
    let wakeLock = null;
    let preGrantedDeviceId = null;     // 前置權限流程選到的相機 ID（降級模式用）
    let activeFallbackStream = null;   // 降級模式串流
    let sceneCanvas = null;            // A-Frame WebGL 畫布
    let stageActive = false;

    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    function toast(msg, dur = 2000){
      const t = $('#toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), dur);
    }

    function setStatus(msg){
      $('#statusText').textContent = msg;
    }

    function isSecureContextOk(){
      return (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1');
    }

    function hasWebGL2(){
      try{ const c = document.createElement('canvas'); return !!(c.getContext('webgl2') || c.getContext('experimental-webgl2')); }
      catch(e){ return false; }
    }

    async function requestMotionPermissionIfNeeded(){
      // iOS 13+ 需要互動手勢下主動要求
      const any = window.DeviceMotionEvent || window.DeviceOrientationEvent;
      const dm = window.DeviceMotionEvent;
      const doevt = window.DeviceOrientationEvent;
      try{
        if (typeof dm?.requestPermission === 'function'){
          await dm.requestPermission().catch(()=>{});
        }
        if (typeof doevt?.requestPermission === 'function'){
          await doevt.requestPermission().catch(()=>{});
        }
      }catch(e){
        // 可忽略；MindAR 對影像追蹤不一定需要
      }
    }

    async function requestWakeLock(){
      try{
        if ('wakeLock' in navigator){
          wakeLock = await navigator.wakeLock.request('screen');
          document.addEventListener('visibilitychange', async ()=>{
            if (document.visibilityState === 'visible' && !wakeLock){
              try{ wakeLock = await navigator.wakeLock.request('screen'); }catch{}
            }
          });
          wakeLock.addEventListener?.('release', ()=>{ wakeLock = null; });
        }
      }catch(e){ /* 某些裝置不支援或使用者拒絕 */ }
    }

    async function preflightCamera(){
      // 第一層保險：主動以 environment 嘗試，失敗再列舉裝置找後鏡頭
      const tryGet = async (constraints) => {
        const s = await navigator.mediaDevices.getUserMedia(constraints);
        const track = s.getVideoTracks()[0];
        const settings = track.getSettings ? track.getSettings() : {};
        preGrantedDeviceId = settings.deviceId || null;
        // 立即停止，讓 MindAR 後續接手；權限已授予，所以不再彈窗
        s.getTracks().forEach(t=>t.stop());
        return true;
      };

      // 先嘗試後鏡頭（ideal）
      try{
        await tryGet({video:{ facingMode: {ideal:'environment'}, width:{ideal:1280}, height:{ideal:720} }, audio:false});
        return true;
      }catch(e){ /* 繼續列舉 */ }

      // 列舉裝置，找名稱包含 back/rear 的相機
      try{
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videos = devices.filter(d=>d.kind==='videoinput');
        let back = videos.find(v => /back|rear|environment/i.test(v.label));
        if (!back && videos.length) back = videos[videos.length-1]; // 退而求其次
        if (back){
          await tryGet({video:{ deviceId:{exact: back.deviceId}, width:{ideal:1280}, height:{ideal:720} }, audio:false});
          return true;
        }
      }catch(e){ /* 繼續下一步 */ }

      // 最後再試普通相機
      try{
        await tryGet({video:true, audio:false});
        return true;
      }catch(e){
        throw new Error('無法取得相機權限：' + (e?.message || e));
      }
    }

    function getMindARCameraVideo(){
      // 嘗試從 MindAR 系統取，否則掃描頁面上的 video 元素（srcObject 為 MediaStream 且 muted）
      const sceneEl = $('#arScene');
      let fromSystem = null;
      try{
        const sys = sceneEl.systems && sceneEl.systems['mindar-image-system'];
        if (sys && sys.video) fromSystem = sys.video;
      }catch(e){}
      if (fromSystem) return fromSystem;

      const candidates = $$('video').filter(v => v.srcObject instanceof MediaStream);
      // 過濾掉 overlayVideo（它不是 MediaStream）
      return candidates[0] || null;
    }

    function getSceneCanvas(){
      const sceneEl = $('#arScene');
      return sceneEl?.canvas || null;
    }

    async function startAR(){
      // 顯示場景
      $('#home').style.display = 'none';
      $('#stage').classList.add('active');
      stageActive = true;
      setStatus('初始化中…');

      // 第二層保險：若 WebGL2 缺失，直接降級
      if (!hasWebGL2()){
        setStatus('此裝置不支援 WebGL2，使用降級相機模式');
        await startFallbackCamera();
        return;
      }

      const sceneEl = $('#arScene');

      // 等待 A-Frame 場景完成建立（才拿得到 canvas）
      if (!sceneEl.hasLoaded){
        await new Promise(res => sceneEl.addEventListener('loaded', res, {once:true}));
      }
      sceneCanvas = getSceneCanvas();

      // MindAR 事件監聽
      sceneEl.addEventListener('arReady', ()=>{
        setStatus('AR 就緒，對準測試圖就會出現覆層');
        // 自動播放覆層影片（行動端需在使用者互動後執行）
        if (CONFIG.autoplayOverlayVideo){
          const v = $('#overlayVideo');
          v?.play().catch(()=>{ /* 若被瀏覽器阻擋，可改為顯示播放按鈕 */ });
        }
      });
      sceneEl.addEventListener('arError', async (e)=>{
        console.warn('MindAR 啟動失敗：', e);
        toast('AR 啟動失敗，切換到降級相機模式');
        await startFallbackCamera();
      });

      setStatus('相機啟動中…');

      // MindAR 預設會自行呼叫 getUserMedia（我們前面已授權，這裡通常不再彈窗）
      // 額外保險：若一段時間仍沒 arReady，就啟動降級
      const fallbackTimer = setTimeout(async ()=>{
        if (!stageActive) return;
        setStatus('AR 逾時，切換降級相機模式');
        await startFallbackCamera();
      }, 12000);

      // 若成功 arReady，清除逾時計時
      sceneEl.addEventListener('arReady', ()=>clearTimeout(fallbackTimer), {once:true});
    }

    async function startFallbackCamera(){
      $('#stage').classList.remove('active');
      $('#fallback').classList.add('active');
      stageActive = false;

      try{
        // 盡量用之前選到的後鏡頭
        const constraints = preGrantedDeviceId
          ? {video: {deviceId:{exact: preGrantedDeviceId}, width:{ideal:1280}, height:{ideal:720}}, audio:false}
          : {video: {facingMode:{ideal:'environment'}}, audio:false};
        activeFallbackStream = await navigator.mediaDevices.getUserMedia(constraints);
        $('#fallbackVideo').srcObject = activeFallbackStream;
      }catch(e){
        toast('相機啟動失敗：' + (e?.message||e));
      }
    }

    function stopFallbackCamera(){
      try{
        if (activeFallbackStream){
          activeFallbackStream.getTracks().forEach(t=>t.stop());
          activeFallbackStream = null;
        }
      }catch(e){}
      $('#fallback').classList.remove('active');
    }

    function dataUrlDownload(dataUrl, filename){
      const a = document.createElement('a');
      a.href = dataUrl; a.download = filename;
      document.body.appendChild(a);
      a.click();
      setTimeout(()=>a.remove(), 0);
    }

    function openInNewTab(dataUrl){
      // iOS 可能不支援 download，退而求其次
      const w = window.open();
      if (w){ w.document.title = 'Screenshot'; w.document.body.style.margin='0'; 
        const img = new Image(); img.src = dataUrl; img.style.width='100%'; img.style.height='auto';
        w.document.body.appendChild(img);
      }else{
        // 最後手段：直接換當前頁
        location.href = dataUrl;
      }
    }

    function getCaptureSize(){
      // 優先用相機影片解析度，其次用 canvas，其次視窗
      const v = getMindARCameraVideo() || $('#fallbackVideo');
      if (v && v.videoWidth && v.videoHeight){
        return {w: v.videoWidth, h: v.videoHeight, videoEl: v};
      }
      if (sceneCanvas){
        return {w: sceneCanvas.width, h: sceneCanvas.height, videoEl: getMindARCameraVideo()};
      }
      return {w: window.innerWidth, h: window.innerHeight, videoEl: getMindARCameraVideo()};
    }

    function captureComposite(arMode = true){
      // 合成順序：相機 → WebGL（A-Frame）→（你也可在此加上 UI/水印）
      const {w, h, videoEl} = getCaptureSize();
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');

      if (videoEl){
        try{ ctx.drawImage(videoEl, 0, 0, w, h); }catch(e){}
      }
      if (arMode && sceneCanvas){
        try{ ctx.drawImage(sceneCanvas, 0, 0, w, h); }catch(e){}
      }

      try{
        return canvas.toDataURL('image/png');
      }catch(e){
        console.warn('toDataURL 失敗，嘗試備援：', e);
        // 備援：僅輸出 WebGL 畫面或僅影片畫面
        try{
          if (arMode && sceneCanvas) return sceneCanvas.toDataURL('image/png');
        }catch(e2){}
        try{
          if (videoEl){
            const canvas2 = document.createElement('canvas');
            canvas2.width = w; canvas2.height = h;
            canvas2.getContext('2d').drawImage(videoEl, 0, 0, w, h);
            return canvas2.toDataURL('image/png');
          }
        }catch(e3){}
        return null;
      }
    }

    function saveScreenshot(arMode = true){
      const url = captureComposite(arMode);
      if (!url){ toast('截圖失敗'); return; }
      try{
        dataUrlDownload(url, CONFIG.screenshotName);
        toast('已儲存');
      }catch(e){
        openInNewTab(url);
        toast('已於新分頁開啟圖片，可長按儲存');
      }
    }

    async function enterFlow(){
      // 入口總控：兩重保險 + 權限請求（以使用者點擊為手勢）
      if (!isSecureContextOk()){
        alert('需要 HTTPS（或同機 localhost）才能啟用相機。請部署到 HTTPS 或使用 ngrok/Netlify/GitHub Pages。');
        return;
      }
      setStatus('檢查權限…');
      try{
        await requestMotionPermissionIfNeeded(); // iOS 動作/方向（可選）
        await requestWakeLock();                 // 常亮（可選）
        await preflightCamera();                 // 第一層保險：先拿到相機授權
      }catch(e){
        alert((e && e.message) ? e.message : String(e));
        return;
      }
      await startAR();                           // 正式進入 AR（第二層保險：啟動失敗自動降級）
      // 全螢幕（可選）
      try{
        const el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen({navigationUI: 'hide'});
      }catch(e){}
    }

    function exitAll(){
      // 統一退出：關閉 AR 與降級相機、釋放資源
      try{
        const sceneEl = $('#arScene');
        const sys = sceneEl.systems && sceneEl.systems['mindar-image-system'];
        // 嘗試停止 MindAR
        if (sys && typeof sys.stop === 'function') sys.stop();
        // 額外嘗試（不同版本可能掛在 component）
        if (sceneEl.components && sceneEl.components['mindar-image'] && typeof sceneEl.components['mindar-image'].stop === 'function'){
          sceneEl.components['mindar-image'].stop();
        }
      }catch(e){}
      stopFallbackCamera();
      if (wakeLock){ try{ wakeLock.release?.(); }catch(e){} wakeLock = null; }
      $('#stage').classList.remove('active');
      $('#fallback').classList.remove('active');
      $('#home').style.display = '';
      stageActive = false;
      setStatus('就緒');
      try{ document.exitFullscreen?.(); }catch(e){}
    }

    // 綁定 UI
    $('#enterBtn').addEventListener('click', enterFlow);
    $('#exitBtn').addEventListener('click', exitAll);
    $('#exitBtn2').addEventListener('click', exitAll);
    $('#saveBtn').addEventListener('click', ()=>saveScreenshot(true));
    $('#saveBtn2').addEventListener('click', ()=>saveScreenshot(false));
    $('#helpBtn').addEventListener('click', ()=>{
      alert([
        '使用方式：',
        '1) 用另一台裝置打開示範圖像（card.png）',
        '2) 點「進入 AR」，允許相機權限',
        '3) 對準圖像，會出現覆層圖片與影片',
        '4) 點「儲存」可把畫面存成圖片',
        '',
        '小提示：若 AR 無法啟動，系統會自動切到「降級相機模式」，仍然可以截圖。'
      ].join('\n'));
    });
    $('#howBtn').addEventListener('click', ()=>{
      alert([
        '部署指引（簡版）：',
        '• 務必使用 HTTPS 網址（或 localhost）。',
        '• 推薦免費選項：Netlify / GitHub Pages / Cloudflare Pages。',
        '• 直接把這個 index.html 上傳即可（單檔版）。',
        '• iOS Safari 若要全螢幕沉浸體驗，可加入主畫面（PWA 模式效果更佳）。'
      ].join('\n'));
    });

    // 阻止雙擊縮放
    document.addEventListener('touchend', (e)=>{
      const now = Date.now(); if (!window.__lastTouch) window.__lastTouch = 0;
      if (now - window.__lastTouch < 300) e.preventDefault();
      window.__lastTouch = now;
    }, {passive:false});
  </script>
</body>
</html>